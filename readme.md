# Integrating Fuzzy Logic into Deep Symbolic Regression

Integrating Fuzzy Logic into Deep Symbolic Regression developed by Petersen et al. [Paper](https://openreview.net/forum?id=m5Qsh0kBQG) is done by altering the DSO package.

The framework utilizes deep reinforcement learning techniques to produce explainable equations that can be utilized to study fraudulent transactions using fuzzy logic implications.

## Installation

Clone the Deep Symbolic Optimization Repository to the root directory:

git clone https://github.com/brendenpetersen/deep-symbolic-optimization.git

Follow the corresponding install instructions. You only have to install the Core package, since we only use regression.

cp main/functions.py deep-symbolic-optimization/dso/dso
cp main/program.py deep-symbolic-optimization/dso/dso
cp main/regression.py deep-symbolic-optimization/dso/dso/task/regression/
cp main/config_logic.json deep-symbolic-optimization/dso/dso/config/


## Dataset Preprocessing

First, download the PaySim dataset from this Kaggle competition [Kaggle](https://www.kaggle.com/datasets/ealaxi/paysim1)
Change the filename to paysim.csv and move it to the root directory.

Data preprocessing is done by running Data_preparation.ipynb.

Note that this will create a subset of 2 million samples. The size can be customized within the notebook.

This will create train_df.csv and test_df.csv in deep-symbolic-optimization/dso/dso/task/regression/data.

## Train the model

The model is trained using different config files. These files can be found in Main/Config_files/.
You can copy the content of these files into the config_logic.json file, and copy the file into the corresponding location in the DSO package:

cp main/config_logic.json deep-symbolic-optimization/dso/dso/config/

Descriptions of the other parameters can be found https://github.com/dso-org/deep-symbolic-optimization.

Training the model with the given parameters can be done by running the code from the root directory:

python -m dso.run deep-symbolic-optimization/dso/dso/config/config_logic.json --runs=16 --n_cores_task=16 --seed=42

Where --runs specifies the amount of runs, --n_cores_task specifies the amount of cores assigned per task and --seed specifies at which seed to start. Currently, utilising multiple cores for a single run is not possible due to pickling errors. 

This will save a timestamped log directory in deep-symbolic-optimization-master/dso/log. The directory consists of several files that contain summary statistics of the run.

## Test the generated equations

To check how one of the generated equations performs on the train or test set, you can analyze all the expressions generated by a single config file. Alter the range of seeds evaluated in line 59, and alter line 63 to the correct folder and filename. Then run, from the root directory:

python main/Results_evaluation.py

By running this code a csv file is created called summary.csv, which contains evaluated expression printed in a interpretable manner, associated complexity, seed, F1 score, accuracy, precision and recall. The summary.csv contains the evaluted expressions for a full config run, evaluating all expressions for all used seeds.